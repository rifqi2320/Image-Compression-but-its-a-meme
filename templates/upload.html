{% extends "index.html" %}
{% block content %}

<h1>From upload html</h1>

{% for messages in get_flashed_messages() %}
  <script>
    const messages = "{{ messages }}";

    if (messages.isArray) {
      for (var i=0; i<messages.length; i++) {
        alert(messages[i]);
      }
    } else {
      alert(messages)
    }
  </script>
{% endfor %}

<form method="POST" action="{{ url_for('upload') }}" enctype="multipart/form-data">
  <div>
    <div class="form-group">
      {{form.image.label(class="form-control-file")}}
      {{form.image(class="pb-3", onchange="showImgInput(event)")}}
      {% if form.image.errors %}
        {% for error in form.image.errors%}
          <span class="text-danger">{{error}}</span>
          <br />
        {%endfor%}
      {%endif%}
    </div>

    <div class="form-group">
      {{form.rate.label(class="form-control-label")}}
      {% if form.rate.errors %}
        {{ form.rate(class="form-control form-control-md is-invalid") }}
        <div class="invalid-feedback">
          {%for error in form.rate.errors%}
            <span>{{error}}</span>
          {%endfor%}
        </div>
      {%else%}
        {{form.rate(id="inputScale", type="range", oninput="changeScale()", min="1", max="100")}}
        <span id="inputPercentage">
          {{rate}}
        </span>%
      {%endif%}
    </div>
    <div class="form-group">
      {{form.submit(class="btn btn-outline-info")}}
    </div>  
  </div>
</form>


{% if isLoading %}
  <div id="loading" style="display:none;">
    <h1>Please wait</h1>
  </div>
{%endif%}

<!-- {% if rate and (rate >= 1 and rate <= 100) %}
  <div>
    <h1>
      RATE COMPRESSION: <span>{{rate}}%</span>
    </h1>
  </div>
{%endif%} -->

<div class="row my-4">
  {% if imgFilename and (not isLoading) %}
    <h1>Your image</h1>
    <img src="{{url_for('static', filename='uploads/'+imgFilename)}}">

    <h1>Compressed image</h1>
    <img src="{{url_for('static', filename='downloads/'+imgFilename)}}">
  {%else%}
    <div class="col">
      <h2>
        Before: <br>
      </h2>
      <!-- image here -->
      <img id="imgInput" class="img-fluid"
        src="https://i.kym-cdn.com/photos/images/original/001/369/583/626.jpg_large">
    </div>
    <div class="col">
      <h2>
        After: <br>
      </h2>
      <a href="https://i.kym-cdn.com/photos/images/original/001/369/583/626.jpg_large" download="output.jpg">
        <!-- image here -->
        <img id="imgOutput" class="img-fluid"
          src="https://i.kym-cdn.com/photos/images/original/001/369/583/626.jpg_large">
      </a>
    </div>
  {%endif%}
</div>

<p class="mt-4">
  Image pixel difference percentage:
  <span id="pixelDiff">
    {{rate}}
  </span> %
  <br>
  Image compression time:
  <span id="compressTime">
    {{compressionDuration}}
  </span> sec
</p>

{% endblock content %}
